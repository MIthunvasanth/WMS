<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Assign Work</title>
  <style>
    /* Styles are the same as you provided — omitted here for brevity */
  </style>
</head>
<body>
  <a class="back-link" href="index.html">← Back</a>
  <h1>Assign Work</h1>

  <form id="assignmentForm">
    <label>
      Inner Bearing Quantity:
      <input type="number" name="innerBearing" min="0" placeholder="Enter quantity" />
    </label>
    <label>
      CVT Tank Quantity:
      <input type="number" name="cvtTank" min="0" placeholder="Enter quantity" />
    </label>
    <button type="submit">Schedule</button>
  </form>

  <div class="listbutton">
    <div style="width: 100%; display: flex; gap: 20px; justify-content: center;">
      <button class="btn-view" style="width: 40%; background-color: #28a745;" onclick="window.location.href = 'list-inner-bearing.html'">View Inner Bearing Work</button>
      <button class="btn-view" style="width: 40%; background-color: #284ea7;" onclick="window.location.href = 'list-cvt-tank.html'">View CVT Tank Work</button>
    </div>
  </div>

  <div class="buttons">
    <button class="btn-reset" id="resetBtn">Reset Scheduler</button>
  </div>

  <script>
    const products = {
      "Inner Bearing": [
        { name: "Cutting", processTime: 30, machineNeeded: "VTL" },
        { name: "Slot Mill", processTime: 50, machineNeeded: "VMC 1" },
        { name: "Debour", processTime: 20, machineNeeded: "Manual 1" },
        { name: "Tapping", processTime: 12, machineNeeded: "CNC Tapping" },
        { name: "Marking", processTime: 3, machineNeeded: "Dot Marking" },
        { name: "Welding", processTime: 40, machineNeeded: ["Welding 1", "Welding 2", "Welding 3", "Welding 4"] }
      ],
      "CVT Tank": [
        { name: "Marking", processTime: 2, machineNeeded: "Dot Marking" },
        { name: "Bending", processTime: 24, machineNeeded: "Press Brake" },
        { name: "Setting", processTime: 20, machineNeeded: "Welding 3" },
        { name: "Full Weld", processTime: 40, machineNeeded: ["Welding 1", "Welding 2", "Welding 3", "Welding 4"] }
      ]
    };

    let schedule = JSON.parse(localStorage.getItem("scheduledTimeline")) || [];

    function addJob(productName, quantity) {
      const processList = products[productName];
      const start = new Date();
      start.setHours(9, 0, 0, 0); // Start at 9 AM today
      let current = new Date(start);

      for (let i = 1; i <= quantity; i++) {
        processList.forEach(proc => {
          const machine = Array.isArray(proc.machineNeeded)
            ? proc.machineNeeded[Math.floor(Math.random() * proc.machineNeeded.length)]
            : proc.machineNeeded;

          const jobStart = new Date(current);
          const jobEnd = new Date(current.getTime() + proc.processTime * 60000);
          schedule.push({
            product: productName,
            process: proc.name,
            machine,
            quantity: 1,
            start: jobStart,
            end: jobEnd,
            completed: false
          });
          current = new Date(jobEnd);
        });
        // Add 1 hour break between units
        current.setMinutes(current.getMinutes() + 60);
      }

      localStorage.setItem("scheduledTimeline", JSON.stringify(schedule));
    }

    function resetScheduler() {
      schedule = [];
      localStorage.removeItem("scheduledTimeline");
    }

    document.getElementById('assignmentForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const form = new FormData(e.target);
      const innerBearingQty = parseInt(form.get('innerBearing')) || 0;
      const cvtTankQty = parseInt(form.get('cvtTank')) || 0;

      if (innerBearingQty > 0) addJob("Inner Bearing", innerBearingQty);
      if (cvtTankQty > 0) addJob("CVT Tank", cvtTankQty);

      if (innerBearingQty || cvtTankQty) {
        alert("Schedule assigned!");
        e.target.reset();
      } else {
        alert("Please enter at least one quantity.");
      }
    });

    document.getElementById('resetBtn').addEventListener('click', function () {
      const confirmReset = confirm('Are you sure you want to reset the entire schedule?');
      if (confirmReset) {
        resetScheduler();
        alert('Scheduler reset successfully!');
        window.location.reload();
      }
    });
  </script>
</body>
</html>
