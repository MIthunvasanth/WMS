<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Assign Work</title>
  <style>
    /* Same clean modern styling as before */
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f4f8;
      padding: 40px;
      margin: 0;
    }
    .container {
      max-width: 600px;
      margin: auto;
      padding: 30px;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    h1 { text-align: center; color: #333; }
    label { display: block; margin-top: 15px; font-weight: 500; color: #555; }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border-radius: 6px;
      font-size: 16px;
    }
    input { border: 1px solid #ccc; }
    button {
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      transition: 0.3s;
      margin-top: 20px;
    }
    button:hover { background: #0056b3; }
    .link-buttons {
      display: flex;
      justify-content: space-between;
      gap: 15px;
      margin-top: 30px;
    }
    .btn-view {
      flex: 1;
      border: none;
      color: white;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      padding: 12px;
    }
    .green { background: #28a745; }
    .blue { background: #284ea7; }
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      text-decoration: none;
      color: #007bff;
      font-weight: bold;
    }
  </style>
</head>
<body>

<a class="back-link" href="index.html">‚Üê Back</a>

<div class="container">
  <h1>Assign Work</h1>

  <form id="assignmentForm">
    <label>Inner Bearing Quantity:
      <input type="number" name="innerBearing" min="0" />
    </label>
    <label>CVT Tank Quantity:
      <input type="number" name="cvtTank" min="0" />
    </label>
    <label>Start Date & Time:
      <input type="datetime-local" name="startTime" required />
    </label>
    <label>End Date & Time:
      <input type="datetime-local" name="endTime" required />
    </label>
    <label>Daily Work Hours:
      <input type="number" name="dailyHours" min="1" max="24" required />
    </label>
    <button type="submit">Schedule</button>
  </form>

  <div class="link-buttons">
    <button class="btn-view green" onclick="window.location.href='list-inner-bearing.html'">View Inner Bearing Work</button>
    <button class="btn-view blue" onclick="window.location.href='list-cvt-tank.html'">View CVT Tank Work</button>
  </div>
</div>

<script>
const products = {
  "Inner Bearing": [
    { name: "Cutting", processTime: 30, machineNeeded: "VTL" },
    { name: "Slot Mill", processTime: 50, machineNeeded: "VMC 1" },
    { name: "Debour", processTime: 20, machineNeeded: "Manual 1" },
    { name: "Tapping", processTime: 12, machineNeeded: "CNC Tapping" },
    { name: "Marking", processTime: 3, machineNeeded: "Dot Marking" },
    { name: "Welding", processTime: 40, machineNeeded: ["Welding 1", "Welding 2", "Welding 3", "Welding 4"] }
  ],
  "CVT Tank": [
    { name: "Marking", processTime: 2, machineNeeded: "Dot Marking" },
    { name: "Bending", processTime: 24, machineNeeded: "Press Brake" },
    { name: "Setting", processTime: 20, machineNeeded: "Welding 3" },
    { name: "Full Weld", processTime: 40, machineNeeded: ["Welding 1", "Welding 2", "Welding 3", "Welding 4"] }
  ]
};

function addJob(productName, quantity, startTime, endTime, dailyHours) {
  const processList = products[productName];
  const dailyLimit = dailyHours * 60;
  let workDayStart = new Date(startTime);
  const workDayEnd = new Date(endTime);

  let workMinutesUsed = 0;
  let currentTime = new Date(workDayStart);
  const schedule = [];

  for (let i = 1; i <= quantity; i++) {
    for (const proc of processList) {
      const machine = Array.isArray(proc.machineNeeded)
        ? proc.machineNeeded[Math.floor(Math.random() * proc.machineNeeded.length)]
        : proc.machineNeeded;

      if (workMinutesUsed + proc.processTime > dailyLimit) {
        workDayStart.setDate(workDayStart.getDate() + 1);
        workDayStart.setHours(currentTime.getHours(), currentTime.getMinutes(), 0, 0);
        workMinutesUsed = 0;
        currentTime = new Date(workDayStart);
        if (currentTime > workDayEnd) {
          alert("Not enough time between start and end to finish scheduling!");
          return;
        }
      }

      const jobStart = new Date(currentTime);
      const jobEnd = new Date(currentTime.getTime() + proc.processTime * 60000);

      schedule.push({
        product: productName,
        process: proc.name,
        machine,
        quantity: 1,
        start: jobStart,
        end: jobEnd,
        completed: false
      });

      currentTime = new Date(jobEnd);
      workMinutesUsed += proc.processTime;
    }

    currentTime.setMinutes(currentTime.getMinutes() + 60); // 1 hour break between units
  }

  const key = productName.replace(/\s+/g, '').toLowerCase() + "Schedule";
  const existing = JSON.parse(localStorage.getItem(key)) || [];
  localStorage.setItem(key, JSON.stringify([...existing, ...schedule]));
}

document.getElementById('assignmentForm').addEventListener('submit', function (e) {
  e.preventDefault();
  const form = new FormData(e.target);
  const innerQty = parseInt(form.get('innerBearing')) || 0;
  const cvtQty = parseInt(form.get('cvtTank')) || 0;
  const startTime = new Date(form.get('startTime'));
  const endTime = new Date(form.get('endTime'));
  const dailyHours = parseInt(form.get('dailyHours')) || 8;

  if (endTime <= startTime) {
    alert("End time must be after start time.");
    return;
  }

  if (innerQty > 0) addJob("Inner Bearing", innerQty, startTime, endTime, dailyHours);
  if (cvtQty > 0) addJob("CVT Tank", cvtQty, startTime, endTime, dailyHours);

  if (innerQty || cvtQty) {
    alert("Schedule successfully assigned!");
    e.target.reset();
  } else {
    alert("Please enter at least one quantity.");
  }
});
</script>

</body>
</html>
